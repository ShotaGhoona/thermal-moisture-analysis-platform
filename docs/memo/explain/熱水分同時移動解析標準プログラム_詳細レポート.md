# 熱水分同時移動解析標準プログラム ver2.3.1 詳細技術レポート

## 目次
1. [プログラム概要](#プログラム概要)
2. [システム構成](#システム構成)
3. [理論的背景](#理論的背景)
4. [モジュール構造](#モジュール構造)
5. [材料物性データベース](#材料物性データベース)
6. [計算手法](#計算手法)
7. [入力・出力仕様](#入力・出力仕様)
8. [プログラム詳細解析](#プログラム詳細解析)
9. [応用例と検証](#応用例と検証)
10. [今後の展望](#今後の展望)

---

## プログラム概要

### 基本機能
熱水分同時移動解析標準プログラム ver2.3.1は、Julia言語で開発された建築環境工学分野における数値解析プログラムです。建築材料内部の熱と水分の同時移動現象を高精度で予測し、結露・湿害対策や省エネルギー建築設計に活用されています。

### 主要な特徴
- **多次元解析対応**: 1次元、3次元、建物全体ネットワーク解析
- **連成現象の考慮**: 熱・水分の相互作用を物理的に正確にモデル化
- **豊富な材料データベース**: 伝統材料から最新材料まで40種類以上
- **実用的な境界条件**: 実際の建築環境に対応した境界条件設定
- **高精度数値解法**: 有限差分法、ニュートン法による高精度計算

### 適用分野
- 文化財建造物の保存環境設計
- 高性能住宅の温湿度環境予測
- 建築材料の長期耐久性評価
- 結露・カビ・腐朽リスクの定量評価

---

## システム構成

### プログラム全体構成

```
熱水分同時移動解析標準プログラム ver2.3.1/
├── メインプログラム/
│   ├── 1D_calculation.ipynb           # 1次元解析
│   ├── 3D_calculation.ipynb           # 3次元解析
│   ├── network_calculation.ipynb      # 建物ネットワーク解析
│   └── main_calc_multivent.ipynb      # 多層室換気解析
├── モジュール/
│   ├── transfer_in_media.jl           # 熱水分移動計算
│   ├── building_network_model.jl      # 建物モデル
│   ├── cell.jl                        # セル構造体
│   ├── material_property/             # 材料物性値
│   └── function/                      # 数値計算関数
├── 入力データ/
│   ├── 1D_model/                      # 1次元モデル設定
│   ├── 3D_data/                       # 3次元データ
│   ├── climate_data/                  # 気象データ
│   └── building_network_model/        # ネットワーク設定
└── 出力データ/
    └── result_*.csv                   # 計算結果
```

### 実行環境
- **言語**: Julia 1.x
- **必要パッケージ**: CSV, DataFrames, Dates, Plots
- **OS**: Windows, macOS, Linux対応
- **推奨システム**: メモリ8GB以上、マルチコアCPU

---

## 理論的背景

### 1. 熱伝導方程式

#### 支配方程式
```
∂T/∂t = ∇(λ∇T)/ρc + Sm
```

**各項の物理的意味:**
- T: 温度 [K]
- λ: 熱伝導率 [W/m·K]
- ρc: 体積熱容量 [J/m³·K]
- Sm: 熱源項（潜熱による影響）

#### 離散化式
```julia
# 1次元熱伝導の離散化
q = -λ * (T[i+1] - T[i]) / dx
```

### 2. 水分移動方程式

#### 化学ポテンシャル駆動
```
∂φ/∂t = ∇(λmg∇μ + λtg∇T)
```

**各項の説明:**
- φ: 含水率 [kg/kg]
- μ: 水分化学ポテンシャル [J/kg]
- λmg: 湿気伝導率（化学ポテンシャル勾配）
- λtg: 湿気伝導率（温度勾配、ソレー効果）

#### 実装例
```julia
# 水蒸気移動の計算
jv = -(ldmg * dmiu / dx2 + ldtg * dtemp / dx2)
```

### 3. 連成現象

#### 熱・水分相互作用
1. **潜熱効果**: 水分の蒸発・凝縮による熱の吸収・放出
2. **ソレー効果**: 温度勾配による水分移動
3. **Dufour効果**: 濃度勾配による熱移動

#### 潜熱の計算
```julia
# 蒸発潜熱の温度依存性
latent_heat = 597.5 - 0.559 * (temp - 273.15)
```

### 4. 境界条件

#### 第三種境界条件（Robin境界条件）
```
q = α(Tsurf - Tair) + αr(Trad - Tsurf)
jv = αm(pvsurf - pvair)
```

**パラメータ:**
- α: 対流熱伝達率 [W/m²·K]
- αm: 湿気伝達率 [kg/m²·s·Pa]
- αr: 放射熱伝達率 [W/m²·K]

---

## モジュール構造

### 1. コアモジュール

#### transfer_in_media.jl
**機能**: 材料内の熱水分移動計算
- 熱伝導計算（フーリエの法則）
- 水蒸気移動計算（フィックの法則）
- 液水移動計算（重力考慮）

**主要関数:**
```julia
cal_heat_conduction(lam, dtemp, dx2)      # 熱伝導
cal_vapour_permeance(ldmg, dpv, dx2)      # 水蒸気移動
cal_liquid_conduction(ldml, dmiu, dx2)    # 液水移動
```

#### cell.jl
**機能**: 計算セルの構造体定義
```julia
mutable struct Cell
    i::Array{Int, 1}          # 位置番号
    xyz::Array{Float64,1}     # 位置座標
    dx::Float64               # x方向幅
    temp::Float64             # 温度[K]
    miu::Float64              # 水分化学ポテンシャル[J/kg]
    material_name::String     # 材料名
    # その他の物性値...
end
```

#### boundary_condition.jl
**機能**: 境界条件の定義
- BC_Dirichlet: 温度・湿度固定
- BC_Neumann: 熱流・水分流固定
- BC_Robin: 対流・放射境界条件

### 2. 建物ネットワークモジュール

#### building_network_model.jl
**機能**: 建物全体のモデル化
```julia
mutable struct BNM
    rooms::Array{Room, 1}       # 室内空間
    walls::Array{Wall, 1}       # 壁体構成
    openings::Array{Opening, 1} # 開口
    climate::Climate            # 外界気象
end
```

#### 換気計算
- 圧力仮定法による多室換気計算
- インシデンス行列による回路網表現
- ニュートン・ラフソン法による非線形解法

---

## 材料物性データベース

### 1. データベース構成

#### 材料カテゴリ
1. **伝統材料**: 土壁、和紙、凝灰岩
2. **現代材料**: コンクリート、ALC、断熱材
3. **木質材料**: 合板、構造用合板、ベイツガ
4. **シート材料**: 防湿シート、透湿防水シート
5. **土壌材料**: 各種土壌、砂質土壌

### 2. 主要材料の物性値

#### 和紙（paper_washi）
```julia
# 基本物性
密度: 600 kg/m³
比熱: 1350 J/(kg·K)
熱伝導率: 0.08 W/(m·K)
透湿率: 8.25e-12 kg/(m·Pa·s)

# 含水率特性（van Genuchten式）
α = 0.000133
n = 1.5284
m = 0.3459
```

#### 土壁（mud_wall）
```julia
# 基本物性（藤原2018）
密度: 1650 kg/m³
比熱: 900 J/(kg·K)
熱伝導率: 0.23 W/(m·K)
空隙率: 0.082

# 含水率特性（2区間関数）
if rh < 0.85
    φ = 0.002 + 0.03 * rh
else
    φ = 0.032 + 0.15 * (rh - 0.85)
end
```

#### コンクリート（concrete_goran）
```julia
# 基本物性
密度: 2303.2 kg/m³
比熱: 1100 J/(kg·K)
熱伝導率: 1.3 + 3.5 * φ W/(m·K)  # 湿気依存性

# 含水率特性（複雑な区間関数）
# 5つの区間に分けて定義
```

### 3. 物性値の特徴

#### 熱伝導率の範囲
- 金属プレート: 45.0 W/(m·K)
- コンクリート: 1.3 W/(m·K)
- 木質材料: 0.08-0.113 W/(m·K)
- 断熱材: 0.03-0.045 W/(m·K)

#### 透湿率の範囲
- 防湿シート: 1.69e-15 kg/(m·Pa·s)
- 和紙: 8.25e-12 kg/(m·Pa·s)
- グラスウール: 1.60e-10 kg/(m·Pa·s)

---

## 計算手法

### 1. 数値解法

#### 有限差分法
**空間離散化:**
- 中央差分スキーム
- 物性値の調和平均

**時間積分:**
1. 陽解法（Explicit）
2. ODE解析解法

#### 収束判定
```julia
# 収束条件
relative_error < 1e-6
max_iteration < 1000
```

### 2. 非線形解法

#### ニュートン・ラフソン法
```julia
# 反復式
x[n+1] = x[n] - f(x[n])/f'(x[n])

# 収束条件
|x[n+1] - x[n]| < tolerance
```

#### 建物換気回路網
- インシデンス行列による回路網表現
- ガウス消去法による連立方程式解法
- 圧力・流量の反復計算

### 3. 安定性と精度

#### 安定性条件
```julia
# CFL条件（1次元）
dt < dx² / (2α)
α = λ / (ρc)  # 熱拡散率
```

#### 推奨時間刻み
- 1次元: dt = 0.01秒
- 3次元: dt = 1.0秒
- ネットワーク: dt = 1.0秒

---

## 入力・出力仕様

### 1. 入力データ形式

#### 1次元モデル（CSV形式）
```csv
type,i,dx,dx2,name,temp,rh,phi,miu,alpha,aldm
BC_Robin,1,1.0,1.0,air_in,20.0,0.6,0.0,0.0,9.3,3.2e-8
Cell,2,0.00005,0.00005,paper_washi,20.0,0.6,0.05,-69167.2,0.0,0.0
```

#### 気象データ（CSV形式）
```csv
date,temp,rh,p_atm,Jp,Js,WS,WD,Qs,tau,cloudiness
2023/7/18 11:00,32.8,45.2,101325,0,0,2.5,180,800,0.8,0.3
```

### 2. 出力データ形式

#### 計算結果（CSV形式）
```csv
date,temp_1,rh_1,ah_1,temp_2,rh_2,ah_2,...
2023/7/18 11:00:00,20.0,0.6,0.010,20.1,0.59,0.011,...
```

#### 3次元結果
- 時刻別温度・湿度分布
- ヒートマップ画像
- 等高線図

---

## プログラム詳細解析

### 1. 1D_calculation.ipynb

#### 計算対象
1次元水平壁内熱水分同時移動

#### 主な特徴
- 最も基本的な解析プログラム
- 材料構成の理解に最適
- 高精度な時間刻み（0.01秒）

#### 計算手順
```julia
# 1. モデル構築
target_model = input_cell_data("case_washi_v1.csv")

# 2. 計算ループ
while date_calc ≠ end_date
    cal_flux(target_model)           # 流量計算
    cal_new_value(target_model, dt)  # 新値計算
    date_calc = date_calc + dt       # 時間更新
end
```

### 2. 3D_calculation.ipynb

#### 計算対象
3次元材料内熱水分同時移動

#### 主な特徴
- 複雑形状対応
- XLSX形式データ読み込み
- 3次元可視化機能

#### データ構造
```julia
# 3次元Cell配列
cells = Array{Cell, 3}(undef, nx, ny, nz)

# 3方向流量計算
qx = cal_qx(cell[i,j,k], cell[i+1,j,k])
qy = cal_qy(cell[i,j,k], cell[i,j+1,k])
qz = cal_qz(cell[i,j,k], cell[i,j,k+1])
```

### 3. network_calculation.ipynb

#### 計算対象
建物全体の温湿度環境解析

#### 主な特徴
- 室・壁・開口の統合解析
- 日射・換気の考慮
- 実用的な環境予測

#### BNMモデル
```julia
# 建物ネットワークモデル
model = BNM(
    rooms = [room1, room2, ...],
    walls = [wall1, wall2, ...],
    openings = [opening1, opening2, ...],
    climate = climate_data
)
```

### 4. main_calc_multivent.ipynb

#### 計算対象
多層室換気解析

#### 主な特徴
- 圧力仮定法による解法
- 温度差・風圧駆動
- 瞬時収束計算

#### 解法アルゴリズム
```julia
# 1. インシデンス行列作成
IC = create_incidence_matrix(rooms, openings)

# 2. ニュートン法反復
while error > tolerance
    jacobian = calculate_jacobian(pressures)
    pressures = pressures - jacobian⁻¹ * residuals
end
```

---

## 応用例と検証

### 1. 伝統建築の保存環境解析

#### 和紙の湿気特性評価
- 多層和紙構造の水分移動解析
- 文化財保存に適した環境条件の検討
- 材料劣化リスクの定量評価

#### 土壁の性能評価
- 伝統構法建物の温湿度特性
- 現代建築との性能比較
- 改修工法の効果検証

### 2. 高性能住宅の設計支援

#### 断熱・気密性能の最適化
- 壁体内結露の発生予測
- 断熱材の選定・配置検討
- 気密ライン設計の妥当性検証

#### 室内環境の快適性評価
- 温湿度分布の均一性
- 結露・カビ発生リスク
- エネルギー消費量の最適化

### 3. 材料開発支援

#### 新材料の性能評価
- 物性値データベースへの追加
- 既存材料との性能比較
- 用途適性の検証

#### 複合材料の設計
- 異種材料の組み合わせ効果
- 層構成の最適化
- 界面における現象の解析

---

## 今後の展望

### 1. 機能拡張

#### 高度な物理現象の導入
- 塩分移動の連成解析
- 化学反応を考慮した劣化予測
- 微生物の成長モデル

#### 解析精度の向上
- 適応的メッシュ細分化
- 高次精度差分スキーム
- 並列計算による高速化

### 2. インターフェース改善

#### GUI化
- グラフィカルユーザーインターフェース
- 3次元可視化の強化
- リアルタイム計算結果表示

#### データ連携
- BIM（Building Information Modeling）との連携
- 気象データの自動取得
- クラウド計算対応

### 3. 応用分野の拡大

#### 文化財保存
- 歴史的建造物の保存環境設計
- 文化財の劣化診断・予測
- 保存処理の効果検証

#### 建築環境設計
- ゼロエネルギー建築の設計支援
- 健康・快適性を考慮した環境設計
- 災害時の建築物性能評価

---

## 結論

熱水分同時移動解析標準プログラム ver2.3.1は、建築環境工学分野における熱・水分移動現象の数値解析に特化した、高度に専門化されたシミュレーションツールです。

### 主な特徴
1. **物理的正確性**: 厳密な物理法則に基づく連成解析
2. **豊富な材料データベース**: 伝統材料から最新材料まで網羅
3. **多様な解析手法**: 1次元から建物全体まで対応
4. **実用的な境界条件**: 実際の建築環境に対応

### 意義と価値
- 建築物の長寿命化・高性能化への貢献
- 文化財保存技術の向上
- 建築環境工学の教育・研究支援
- 新材料・新工法の開発支援

このプログラムは、建築分野における数値解析の標準ツールとして、今後も継続的な発展が期待される重要なソフトウェアです。

---

*本レポートは熱水分同時移動解析標準プログラム ver2.3.1の技術的特徴と応用可能性について詳細に分析したものです。プログラムの利用にあたっては、適切な物理的理解と数値解析の知識が必要です。*